---
tags:
  - diary
  - 卒業研究
---
> [!IMPORTANT]
> 雑な思いつきを書いていこう
> 終わったらChatGPTに突っ込んだりして企画書整形しようね


### 背景的な問題

- 実データベースは必ずしもER図や明確な設計書が存在しない（特に実運用DBや古いプロジェクト）。
- 「設計を知らない状態でSQLを書かなければならない」現場は多い。
	- ※実運用時のデータ取り出しは、リファレンスもあるが、膨大過ぎて想像しづらい。
- SQLの学習が「構造を理解してから始まる」ことが前提になっていて、構造がブラックボックスだと手が出しづらい。

| 観点          | 利点                                                     |
| ----------- | ------------------------------------------------------ |
| **実務**      | DB設計者がいない、または設計書が失われたDBの構造理解に使える（レガシーDB再構築、データレイク統合作業） |
| **分析補助**    | BIや分析の現場では、分析者が「どんなデータ構造か？」を問い合わせ履歴から逆算して把握することがある     |
| **学習支援**    | 初学者がSQLを使っていく中で、自分が扱っているDBの構造を自然に・段階的に理解できる支援になる       |
| **UI・UX向け** | 「どのカラムが中心で、何が繋がっているか」が可視化されることで、探索や仮説検証の起点として活用できる     |

### なぜUI/UX？

- SQLクエリは構造をテキストとして記述しているが、その構造的意味は直感的に理解しづらい。
- 特に初学者や非エンジニアにとって、`JOIN`や`WHERE`が「構造としてどう繋がっているのか」は不透明。
- 可視化することで、「あ、このカラムはこう繋がってたのか」が瞬時に把握できるようになる。

###  期待されるメリット

| 利用者         | 効果                                                 |
| ----------- | -------------------------------------------------- |
| **初学者**     | クエリを打てば打つほど、「あ、`user_id`はこことも繋がるのか！」という発見が視覚的に得られる |
| **分析者**     | 自分のクエリ履歴からスキーマ構造を再構成して、データ探索の出発点として使える             |
| **開発者・設計者** | 曖昧な設計があっても、クエリからの「事実ベース」で構造を見直せるツールになる（逆設計支援）      |



昨今、データベースを活用した開発や分析の場面が増える一方で、実運用のデータベースには設計情報やスキーマ図が失われていることが多く、「どのような構造のデータを扱っているのかがわからない状態」がしばしば発生する。特に、学習者や非エンジニアが既存のDBにアクセスしようとしたとき、「テーブル間の関係性」や「カラムの意味」が分からず、クエリを書こうにも手が止まるという事態が起こる。

こうした状況に対し、SQLクエリは実際にデータを利用する中で生成される「構造の痕跡」であるという点に着目し、ユーザーが投げたクエリの内容から逆にデータベース構造を推定するというアプローチは有効であると考えられる。

本研究では、SQLクエリを段階的に投入していくことで、その都度スキーマ構造をインクリメンタルに可視化・補完していく「動的推定ツール」開発を目的とする。特に、初学者がデータベース構造を理解していく過程を支援することを重視し、構文解析・名称解析（NLP）・構造可視化を統合したシステムを構築する。


実装
parserのスケルトン組んだ
SQLGlot

SQL方言を直せるっぽい？
https://zenn.dev/jigjp_engineer/articles/41242313de0ce5

ログ周りはdeepcopyで構造保持しつつ、id塗り替え
[Pythonのcopyとdeepcopyについて #Python - Qiita](https://qiita.com/Kaz_K/items/a3d619b9e670e689b6db)

差分ログを保存できる仕組みを組んだ(動作未確認)
クエリ分解jsonファイル、差分ログjson

来週
ちゃんとしたものでなくて良いので、構造可視化の仕様を固めてみる。



クエリの意味解析からの結果出力（構造+意味解析による予想範囲）が不明瞭
入力制約を意味推定で

参考
[\1903.08621 Column2Vec: Structural Understanding via Distributed Representations of Database Schemas](https://arxiv.org/abs/1903.08621)]

[GitHub - ioriioriiori/sqlreverseanalysis](https://github.com/ioriioriiori/sqlreverseanalysis)